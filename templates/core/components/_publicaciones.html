{% load static utils_filters %}
<div class=" justify-content-center  d-flex flex-column align-items-center">
    {% if user.is_authenticated and user == club.owner %}
        {% include 'clubs/_post_form.html' %}
    {% endif %}
</div>
{% for post in posts %}
    <div class="container mt-3 mb-3 col-lg-12 p-5 border rounded p-4 mx-auto">
        <div class="d-flex align-items-start gap-3 mb-2">
            {% if post.user.profile.avatar %}
                <img src="{{ post.user.profile.avatar.url }}"
                     alt="{{ post.user.username }}"
                     class="review-avatar-img rounded-circle">
            {% else %}
                <div class="review-avatar me-sm-3 mb-2 mb-sm-0">{{ post.user.username|first|upper }}</div>
            {% endif %}
            <div class="flex-grow-1 w-100">
                <span class="fw-bold ">{{ post.user.username }}</span>
                <small class="text-muted ">{{ post.created_at|time_since_short }}</small>
                <div class="mt-4 mb-4 w-100">
                    {% if post.image %}
                        <img src="{{ post.image.url }}"
                             class="img-fluid mb-2"
                             alt="imagen"
                             style="max-height:300px">
                    {% endif %}
                    <div class="ratio ratio-16x9">{{ post.contenido|youtube_embed }}</div>
                </div>
                <div class="d-flex flex-wrap align-items-center gap-2">
                    <span class="d-flex btn p-0 post-like {% if user.is_authenticated and user in post.likes.all %}liked{% endif %}"
                          data-url="{% url 'clubpost_like' post.pk %}">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="20"
                             height="20"
                             viewBox="0 0 512 512">
                            <path fill="black" d="m225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144c39.4-7.6 79.7 1.5 111.8 24.1c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c32.1-22.6 72.4-31.7 111.8-24.2C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20l-.1-.1c-23.1-25.9-58-37.7-92-31.2c-46.6 8.9-80.2 49.5-80.2 96.9v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7L431.2 268a102.7 102.7 0 0 0 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2l-.1.1l-.1.1l-17.8 20c-.3.4-.7.7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z" />
                        </svg>
                        <span class="text-black like-count ms-1">{{ post.likes.count }}</span>
                    </span>
                    <a class="ms-2 d-flex text-decoration-none text-reset"
                       data-bs-toggle="collapse"
                       href="#replies-{{ post.pk }}"
                       role="button"
                       aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="20"
                             height="20"
                             viewBox="0 0 24 24">
                            <g fill="none">
                            <path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z" />
                            <path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10H4a2 2 0 0 1-2-2v-8C2 6.477 6.477 2 12 2Zm0 2a8 8 0 0 0-8 8v8h8a8 8 0 1 0 0-16Zm0 10a1 1 0 0 1 .117 1.993L12 16H9a1 1 0 0 1-.117-1.993L9 14h3Zm3-4a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h6Z" />
                            </g>
                        </svg>
                        <span class="ms-1">{{ post.replies.count }}</span>
                    </a>
                    <button type="button" class="ms-2 p-0 post-share d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="20"
                             height="20"
                             viewBox="0 0 24 24">
                            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                            <circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" />
                            <path d="m8.59 13.51l6.83 3.98m-.01-10.98l-6.82 3.98" />
                            </g>
                        </svg>
                    </button>
                    <div class="ms-auto d-flex align-items-center gap-2 flex-wrap">
                        {% if user.is_authenticated and user == post.user %}
                            <button type="button"
                                    class="btn btn-sm btn-link p-0"
                                    data-bs-toggle="modal"
                                    data-bs-target="#editPostModal{{ post.pk }}">
                                <!-- Edit SVG -->
                                <svg style="height:15px"
                                     viewBox="0 0 512 512"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M495.6 49.23..." />
                                </svg>
                            </button>
                            <form action="{% url 'clubpost_delete' post.pk %}"
                                  method="post"
                                  class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-link text-danger p-0">
                                    <!-- Delete SVG -->
                                    <svg style="height:15px"
                                         viewBox="0 0 448 512"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M432 80h-82.38..." />
                                    </svg>
                                </button>
                            </form>
                        {% endif %}
                    </div>
                    <div class="ms-auto d-flex align-items-center gap-2 flex-wrap">
                        {% if user.is_authenticated and user == post.user %}
                            <button type="button"
                                    class="btn btn-sm btn-link p-0"
                                    data-bs-toggle="modal"
                                    data-bs-target="#editPostModal{{ post.pk }}">
                                <!-- Edit SVG -->
                                <svg style="height:15px"
                                     viewBox="0 0 512 512"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path d="M495.6 49.23l-32.82-32.82C451.8 5.471 437.5 0 423.1 0c-14.33 0-28.66 5.469-39.6 16.41L167.5 232.5C159.1 240 154.8 249.5 152.4 259.8L128.3 367.2C126.5 376.1 133.4 384 141.1 384c.916 0 1.852-.0918 2.797-.2813c0 0 74.03-15.71 107.4-23.56c10.1-2.377 19.13-7.459 26.46-14.79l217-217C517.5 106.5 517.4 71.1 495.6 49.23zM461.7 94.4L244.7 311.4C243.6 312.5 242.5 313.1 241.2 313.4c-13.7 3.227-34.65 7.857-54.3 12.14l12.41-55.2C199.6 268.9 200.3 267.5 201.4 266.5l216.1-216.1C419.4 48.41 421.6 48 423.1 48s3.715 .4062 5.65 2.342l32.82 32.83C464.8 86.34 464.8 91.27 461.7 94.4zM424 288c-13.25 0-24 10.75-24 24v128c0 13.23-10.78 24-24 24h-304c-13.22 0-24-10.77-24-24v-304c0-13.23 10.78-24 24-24h144c13.25 0 24-10.75 24-24S229.3 64 216 64L71.1 63.99C32.31 63.99 0 96.29 0 135.1v304C0 479.7 32.31 512 71.1 512h303.1c39.69 0 71.1-32.3 71.1-72L448 312C448 298.8 437.3 288 424 288z" />
                                </svg>
                            </button>
                            <form action="{% url 'clubpost_delete' post.pk %}"
                                  method="post"
                                  class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-link text-danger p-0">
                                    <!-- Delete SVG -->
                                    <svg style="height:15px"
                                         viewBox="0 0 448 512"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M432 80h-82.38l-34-56.75C306.1 8.827 291.4 0 274.6 0H173.4C156.6 0 141 8.827 132.4 23.25L98.38 80H16C7.125 80 0 87.13 0 96v16C0 120.9 7.125 128 16 128H32v320c0 35.35 28.65 64 64 64h256c35.35 0 64-28.65 64-64V128h16C440.9 128 448 120.9 448 112V96C448 87.13 440.9 80 432 80zM171.9 50.88C172.9 49.13 174.9 48 177 48h94c2.125 0 4.125 1.125 5.125 2.875L293.6 80H154.4L171.9 50.88zM352 464H96c-8.837 0-16-7.163-16-16V128h288v320C368 456.8 360.8 464 352 464zM224 416c8.844 0 16-7.156 16-16V192c0-8.844-7.156-16-16-16S208 183.2 208 192v208C208 408.8 215.2 416 224 416zM144 416C152.8 416 160 408.8 160 400V192c0-8.844-7.156-16-16-16S128 183.2 128 192v208C128 408.8 135.2 416 144 416zM304 416c8.844 0 16-7.156 16-16V192c0-8.844-7.156-16-16-16S288 183.2 288 192v208C288 408.8 295.2 416 304 416z" />
                                    </svg>
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- replies -->
        <div class="collapse mt-3 ms-2 me-2 ms-md-5 me-md-5"
             id="replies-{{ post.pk }}">
            {% for reply in post.replies.all %}
                <div class="d-flex flex-column flex-sm-row border-top pt-4 pb-4 gap-2">
                    {% if reply.user.profile.avatar %}
                        <img src="{{ reply.user.profile.avatar.url }}"
                             alt="{{ reply.user.username }}"
                             class="review-avatar-img rounded-circle me-2">
                    {% else %}
                        <div class="review-avatar me-2">{{ reply.user.username|first|upper }}</div>
                    {% endif %}
                    <div class="flex-grow-1 w-100">
                        <div class="d-flex align-items-center gap-2">
                            <span class="fw-bold">{{ post.user.username }}</span>
                            <small class="text-muted">{{ post.created_at|time_since_short }}</small>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-muted">No hay respuestas.</p>
                {% endfor %}
                {% if user.is_authenticated %}
                    <div class="d-flex flex-column flex-sm-row mt-3 gap-2">
                        {% if user.profile.avatar %}
                            <img src="{{ user.profile.avatar.url }}"
                                 alt="{{ user.username }}"
                                 class="review-avatar-img rounded-circle me-sm-2 flex-shrink-0">
                        {% else %}
                            <div class="review-avatar me-2">{{ user.username|first|upper }}</div>
                        {% endif %}
                        <form method="post"
                              action="{% url 'clubpost_reply' post.pk %}"
                              class="d-flex flex-grow-1 flex-wrap gap-2">
                            {% csrf_token %}
                            {{ reply_form.contenido }}
                            <button type="submit" class="btn btn-dark btn-sm">Responder</button>
                        </form>
                    </div>
                {% else %}
                    <p class="text-muted mt-2">Inicia sesión para responder.</p>
                {% endif %}
            </div>
        </div>
        {% include 'clubs/_post_edit_modal.html' with post=post %}
    {% empty %}
        <p class="m-3 justify-content-center d-flex flex-column align-items-center">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="20"
                 height="20"
                 viewBox="0 0 256 256">
                <path fill="currentColor" d="m198.24 62.63l15.68-17.25a8 8 0 0 0-11.84-10.76L186.4 51.86A95.95 95.95 0 0 0 57.76 193.37l-15.68 17.25a8 8 0 1 0 11.84 10.76l15.68-17.24A95.95 95.95 0 0 0 198.24 62.63M48 128a80 80 0 0 1 127.6-64.25l-107 117.73A79.63 79.63 0 0 1 48 128m80 80a79.55 79.55 0 0 1-47.6-15.75l107-117.73A79.95 79.95 0 0 1 128 208" />
            </svg>
            No hay publicaciones.
        </p>
    {% endfor %}
</div>
