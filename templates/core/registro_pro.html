{% extends 'base.html' %}
{% load static %}
{% block title %}Clubs de Boxeo | Registro Partners{% endblock %}
{% block body_class %}d-flex flex-column min-vh-100{% endblock %}
{% block content %}
    <main class="flex-grow-1">
        <div class="container-fluid  px-3 py-5 ">
            <div class="col-8 mx-auto">
                <ul class="progress-steps mb-5">
                    <li class="step-item active" data-step="1" id="step-label-1"></li>
                    <li class="step-item" data-step="2" id="step-label-2"></li>
                    <li class="step-item" data-step="3" id="step-label-3"></li>
                    <li class="step-item" data-step="4" id="step-label-4"></li>
                </ul>
                <form method="post" class="profile-form mt-5" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ form.non_field_errors }}
                    <input type="hidden"
                           name="current_step"
                           id="current-step"
                           value="{{ start_step }}">
                    <div id="step1" class="step  fade-step d-none">
                        <p class="text-muted text-center">Indícanos qué tipo de profesional eres.</p>
                        <div class="m-5 d-flex justify-content-center flex-wrap gap-3">
                            {% for radio in form.tipo %}
                                <label class="tipo-card">
                                    {{ radio.tag }}
                                    <div class="fw-medium">{{ radio.choice_label }}</div>
                                </label>
                            {% endfor %}
                        </div>
                        {% if form.tipo.errors %}
                            <div class="invalid-feedback d-block">{{ form.tipo.errors.as_text|striptags }}</div>
                        {% endif %}
                        <p class="text-center text-muted mb-5">
                            Elige la opción que mejor se adapte a tus necesidades y comienza a destacar en nuestro directorio.
                        </p>
                        {% include 'core/components/_plan_option_cards.html' %}
                        {% if form.plan.errors %}
                            <div class="invalid-feedback d-block">{{ form.plan.errors.as_text|striptags }}</div>
                        {% endif %}
                    </div>
                    <div id="step2" class="step fade-step d-none">{% include 'core/_pro_register_form.html' with form=pro_form %}</div>
                    <div id="step3" class="step fade-step d-none">
                        {% include 'core/_pro_extra_form.html' with form=extra_form coach_formset=coach_formset %}
                    </div>
                    <div id="step4" class="step fade-step d-none">
                        <h1 class="h5 mb-3 text-center">Pasarela de pagos</h1>
                        <p class="text-muted mb-4 text-center">Ingresa los datos de facturación y de tu tarjeta para completar el registro.</p>
                        <div class="row">
                            <div class="col-md-6">
                                <div id="billing-form" class="mb-4">
                                    <div class="d-flex justify-content-end mb-3">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="copy-billing-data">Usar datos del registro</button>
                                    </div>
                                    <h3 class="h6 mb-3">Datos de facturación</h3>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-field">
                                                <input type="text" id="billing-nombre" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-nombre">Nombre</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-field">
                                                <input type="text" id="billing-apellidos" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-apellidos">Apellidos</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3 mt-0">
                                        <div class="col-md-6">
                                            <div class="form-field">
                                                <input type="email" id="billing-email" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-email">Correo electrónico</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-field">
                                                <input type="date" id="billing-fecha_nacimiento" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-fecha_nacimiento">Fecha de nacimiento</label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-field">
                                                <select id="billing-sexo" class="form-select" required>
                                                    <option value=""></option>
                                                    <option value="hombre">Hombre</option>
                                                    <option value="mujer">Mujer</option>
                                                </select>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-sexo">Sexo</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3 mt-0">
                                        <div class="col-md-3">
                                            <div class="form-field">
                                                <input type="text" id="billing-dni" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-dni">DNI</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-field phone-field">
                                                <input type="text" id="billing-prefijo" class="form-control" value="+34" required>
                                                <input type="text" id="billing-telefono" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-telefono">Teléfono</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6"></div>
                                    </div>
                                    <h3 class="h6 my-3">Dirección</h3>
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <div class="form-field">
                                                <input type="text" id="billing-pais" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-pais">País</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-field">
                                                <input type="text" id="billing-comunidad_autonoma" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-comunidad_autonoma">Comunidad autónoma</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-field">
                                                <input type="text" id="billing-ciudad" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-ciudad">Ciudad</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-field">
                                                <input type="text" id="billing-calle" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-calle">Calle</label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-field">
                                                <input type="text" id="billing-numero" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-numero">Número</label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-field">
                                                <input type="text" id="billing-puerta" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-puerta">Puerta</label>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-field">
                                                <input type="text" id="billing-codigo_postal" class="form-control" required>
                                                <button type="button" class="clear-btn bi bi-x"></button>
                                                <label for="billing-codigo_postal">Código postal</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <form id="payment-form">
                                    <div id="card-element" class="mb-3"></div>
                                    <div id="card-errors" class="text-danger mb-3" role="alert"></div>
                                    <button id="submit-payment" class="btn btn-primary w-100">Pagar</button>
                                </form>
                                <div id="step4-alert" class="alert alert-danger mt-3 d-none" role="alert">
                                    Por favor verifica los datos de la tarjeta.
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="purchase-summary" class="border p-3 rounded">
                                    <h2 class="h6 mb-3">Resumen de la compra</h2>
                                    <p class="mb-1"><strong>Tipo:</strong> <span id="summary-type">-</span></p>
                                    <p class="mb-1"><strong>Plan:</strong> <span id="summary-plan">-</span></p>
                                    <p class="mb-0"><strong>Precio:</strong> <span id="summary-price">-</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex mt-4">
                        <button type="button" class="btn btn-outline-dark d-none" id="prevBtn">Atrás</button>
                        <div class="ms-auto d-flex gap-2">
                            <button type="button" class="btn btn-dark" id="nextBtn">Continuar</button>
                            <button type="submit" class="btn btn-dark d-none" id="finishBtn">Finalizar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
{% endblock %}
{% block extra_js %}
    <script>window.stripePublicKey = "{{ stripe_public_key }}";</script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="{% static 'js/member-location.js' %}"></script>
    <script src="{% static 'js/avatar-dropzone.js' %}"></script>
    <script src="{% static 'js/feature-select.js' %}"></script>
    <script src="{% static 'js/coach-feature-select.js' %}"></script>
    <script src="{% static 'js/pro-registro.js' %}"></script>
    <script src="{% static 'js/about-placeholder.js' %}"></script>
{% endblock %}
