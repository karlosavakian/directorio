{% extends 'base.html' %}
{% block body_class %}club-profile-page{% endblock %}
{% load static star_rating utils_filters %}
{% block content %}
    <div class="container-fluid col-12 px-3 my-3" id="profile-container">
        <!-- Flecha volver arriba -->
        {% include 'partials/_back-btn.html' %}
        <div class="row">
            <!-- Columna Izquierda: Info del Club -->
            <div class="col-lg-2 ">
         <div class="position-relative bg-black club-logo d-flex align-items-center justify-content-center" style="height: 200px;">
            {% if club.logo|safe_url %}
                <img src="{{ club.logo|safe_url }}"
                    class="w-100 h-100"
                    style="object-fit: contain;"
                    alt="{{ club.name }}">
            {% else %}
                <div class="d-flex align-items-center justify-content-center w-100 h-100 bg-dark">
  <span class="d-flex flex-column align-items-center text-white">
                    <svg fill="#fff" width="50px" height="50px" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"> <g data-name="Layer 28" id="Layer_28">

                        <path d="M32,3A29,29,0,1,0,61,32,29,29,0,0,0,32,3Zm0,56A27,27,0,1,1,59,32,27,27,0,0,1,32,59ZM43,37a1,1,0,0,1-1,1H22a1,1,0,0,1,0-2H42A1,1,0,0,1,43,37Zm5.71-19.29L44.41,22l4.3,4.29a1,1,0,0,1,0,1.42,1,1,0,0,1-1.42,0L43,23.41l-4.29,4.3a1,1,0,0,1-1.42,0,1,1,0,0,1,0-1.42L41.59,22l-4.3-4.29a1,1,0,0,1,1.42-1.42L43,20.59l4.29-4.3a1,1,0,0,1,1.42,1.42ZM23,23.41l-4.29,4.3a1,1,0,0,1-1.42,0,1,1,0,0,1,0-1.42L21.59,22l-4.3-4.29a1,1,0,0,1,1.42-1.42L23,20.59l4.29-4.3a1,1,0,0,1,1.42,1.42L24.41,22l4.3,4.29a1,1,0,0,1,0,1.42,1,1,0,0,1-1.42,0Z"/>

                        </g>

                        </svg>
                    <small class="mt-2">Sin logo</small></span>
                </div>
            {% endif %}
            </div>
                <div class="d-flex align-items-start mt-4 mb-4 gap-3 ">
                    <div>
                        <h1 class="h3 mb-2" style="font-weight:900;">{{ club.name }}</h1>
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge ">{{ club.get_category_display }}</span>
                            {% if club.verified %}
                                <span class="ms-2" title="Verificado">
                                    <svg fill="none"
                                         height="24"
                                         viewBox="0 0 24 24"
                                         width="20"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path clip-rule="evenodd" d="M1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12ZM11.2071 16.2071L18.2071 9.20711L16.7929 7.79289L10.5 14.0858L7.20711 10.7929L5.79289 12.2071L9.79289 16.2071C9.98043 16.3946 10.2348 16.5 10.5 16.5C10.7652 16.5 11.0196 16.3946 11.2071 16.2071Z" fill="black" fill-rule="evenodd" />
                                    </svg>
                                </span>
                            {% endif %}
                        </div>
                        <p class="mb-2  d-flex ">
                            <svg class="w-6 h-6 text-gray-800 dark:text-white me-2 "
                                 aria-hidden="true"
                                 xmlns="http://www.w3.org/2000/svg"
                                 width="30"
                                 height="30"
                                 fill="none"
                                 viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.8 13.938h-.011a7 7 0 1 0-11.464.144h-.016l.14.171c.1.127.2.251.3.371L12 21l5.13-6.248c.194-.209.374-.429.54-.659l.13-.155Z" />
                            </svg>
                            <a href="https://www.google.com/maps/search/?api=1&query={{ club.address|urlencode }}"
                               target="_blank"
                               class="text-decoration-none text-reset">{{ club.city }} - {{ club.address }}</a>
                        </p>
                        <p class="mb-2  d-flex align-items-center">
                            <svg class="w-6 h-6 text-gray-800 dark:text-white me-2"
                                 aria-hidden="true"
                                 xmlns="http://www.w3.org/2000/svg"
                                 width="24"
                                 height="24"
                                 fill="none"
                                 viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.427 14.768 17.2 13.542a1.733 1.733 0 0 0-2.45 0l-.613.613a1.732 1.732 0 0 1-2.45 0l-1.838-1.84a1.735 1.735 0 0 1 0-2.452l.612-.613a1.735 1.735 0 0 0 0-2.452L9.237 5.572a1.6 1.6 0 0 0-2.45 0c-3.223 3.2-1.702 6.896 1.519 10.117 3.22 3.221 6.914 4.745 10.12 1.535a1.601 1.601 0 0 0 0-2.456Z" />
                            </svg>
                            <a href="tel:{{ club.phone }}" class="text-decoration-none text-reset">{{ club.phone }}</a>
                        </p>
                        <p class="mb-2  d-flex align-items-center">
                            {% if club.whatsapp_link %}
                                <svg class="w-6 h-6 text-gray-800 dark:text-white me-2"
                                     aria-hidden="true"
                                     xmlns="http://www.w3.org/2000/svg"
                                     width="20"
                                     height="20"
                                     fill="none"
                                     viewBox="0 0 24 24">
                                    <path fill="currentColor" fill-rule="evenodd" d="M12 4a8 8 0 0 0-6.895 12.06l.569.718-.697 2.359 2.32-.648.379.243A8 8 0 1 0 12 4ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10a9.96 9.96 0 0 1-5.016-1.347l-4.948 1.382 1.426-4.829-.006-.007-.033-.055A9.958 9.958 0 0 1 2 12Z" clip-rule="evenodd" />
                                    <path fill="currentColor" d="M16.735 13.492c-.038-.018-1.497-.736-1.756-.83a1.008 1.008 0 0 0-.34-.075c-.196 0-.362.098-.49.291-.146.217-.587.732-.723.886-.018.02-.042.045-.057.045-.013 0-.239-.093-.307-.123-1.564-.68-2.751-2.313-2.914-2.589-.023-.04-.024-.057-.024-.057.005-.021.058-.074.085-.101.08-.079.166-.182.249-.283l.117-.14c.121-.14.175-.25.237-.375l.033-.066a.68.68 0 0 0-.02-.64c-.034-.069-.65-1.555-.715-1.711-.158-.377-.366-.552-.655-.552-.027 0 0 0-.112.005-.137.005-.883.104-1.213.311-.35.22-.94.924-.94 2.16 0 1.112.705 2.162 1.008 2.561l.041.06c1.161 1.695 2.608 2.951 4.074 3.537 1.412.564 2.081.63 2.461.63.16 0 .288-.013.4-.024l.072-.007c.488-.043 1.56-.599 1.804-1.276.192-.534.243-1.117.115-1.329-.088-.144-.239-.216-.43-.308Z" />
                                </svg>
                                <a href="{{ club.whatsapp_link }}"
                                   target="_blank"
                                   class="text-decoration-none text-reset">WhatsApp</a>
                            {% endif %}
                        </p>
                        <p class="mb-2  d-flex align-items-center">
                            <svg class="w-6 h-6 text-gray-800 dark:text-white me-2"
                                 aria-hidden="true"
                                 xmlns="http://www.w3.org/2000/svg"
                                 width="20"
                                 height="20"
                                 fill="none"
                                 viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 8v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8m18 0-8.029-4.46a2 2 0 0 0-1.942 0L3 8m18 0-9 6.5L3 8" />
                            </svg>
                            <a href="mailto:{{ club.email }}"
                               class="text-decoration-none text-reset">{{ club.email }}</a>
                        </p>
                    </div>
                </div>
            </div>
            <!-- Columna Central: GalerÃ­a y Features -->
            <div class="col-lg-8">
                <div class="mb-4   rounded">
                    {% if club.photos.all %}
                        <div class="mb-4 gallery-slideshow position-relative">
                            <div class="gallery-actions">
                                <!-- Heart and Share buttons -->
                                <button id="club-heart"
                                        aria-label="Seguir"
                                        data-url="{% url 'toggle_follow' 'club' club.id %}"
                                        class="{% if club_followed %}liked{% endif %}">
                                    <svg aria-hidden="true"
                                         xmlns="http://www.w3.org/2000/svg"
                                         width="24"
                                         height="24"
                                         fill="none"
                                         viewBox="0 0 24 24">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12.01 6.001C6.5 1 1 8 5.782 13.001L12.011 20l6.23-7C23 8 17.5 1 12.01 6.002Z" />
                                    </svg>
                                </button>
                                <button id="club-share" aria-label="Compartir">
                                    <svg aria-hidden="true"
                                         xmlns="http://www.w3.org/2000/svg"
                                         width="24"
                                         height="24"
                                         fill="none"
                                         viewBox="0 0 24 24">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7.926 10.898 15 7.727m-7.074 5.39L15 16.29M8 12a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Zm12 5.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Zm0-11a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Z" />
                                    </svg>
                                </button>
                            </div>
                            {% for photo in club.photos.all %}
                                <div class="gallery-slide{% if forloop.first %} active{% endif %}">
                                    <img src="{{ photo.image.url }}"
                                         alt="Foto"
                                         class="img-fluid rounded shadow-sm"
                                         style="width:100%;
                                                max-height:500px;
                                                min-height:500px;
                                                object-fit:cover;
                                                background-position:0 0;
                                                user-select: none;
                                                background:rgb(85, 85, 85)">
                                </div>
                            {% endfor %}
                            <button id="galleryPrev" class="slide-arrow left ms-3">
                                <svg viewBox="0 0 48 48">
                                    <path d="M30.83 32.67l-9.17-9.17 9.17-9.17-2.83-2.83-12 12 12 12z" />
                                    <path d="M0-.5h48v48h-48z" fill="none" />
                                </svg>
                            </button>
                            <button id="galleryNext" class="slide-arrow right  me-3">
                                <svg viewBox="0 0 48 48" style="transform:rotate(180deg);">
                                    <path d="M30.83 32.67l-9.17-9.17 9.17-9.17-2.83-2.83-12 12 12 12z" />
                                    <path d="M0-.5h48v48h-48z" fill="none" />
                                </svg>
                            </button>
                            <!-- Bottom-centered Dots -->
                            <div class="gallery-dots-container"
                                 style="position: absolute;
                                        bottom: 15px;
                                        width: 100%;
                                        display: flex;
                                        justify-content: center">
                                <div class="gallery-dots d-flex gap-1">
                                    {% for photo in club.photos.all %}
                                        <span class="gallery-dot{% if forloop.first %} active{% endif %}"></span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <p>No hay fotos todavÃ­a.</p>
                    {% endif %}
                </div>
                <!-- MenÃº de pestaÃ±as -->
                <ul class="border-bottom nav custom-tab-menu mb-3  justify-content-center"
                    id="clubTabs"
                    role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active"
                                id="about-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#about"
                                type="button"
                                role="tab">Sobre el club</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link"
                                id="schedule-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#schedule"
                                type="button"
                                role="tab">Horarios</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link"
                                id="posts-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#posts"
                                type="button"
                                role="tab">Publicaciones</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link"
                                id="competitors-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#competitors"
                                type="button"
                                role="tab">Competidores</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link"
                                id="comments-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#comments"
                                type="button"
                                role="tab">Valoraciones</button>
                    </li>
                </ul>
                <!-- Contenido de pestaÃ±as -->
                <div class="tab-content" id="clubTabsContent">
                    <!-- About -->
                    <div class="tab-pane fade show active" id="about" role="tabpanel">
                        <div class="row p-3">
                            <!-- Columna izquierda: El club -->
                            <div class="col-lg-7">
                                <div class="mb-5">
                                    <h5 class="mb-3">El Club</h5>
                                    <p>{{ club.about|linebreaks }}</p>
                                </div>
                            </div>
                            <!-- Columna derecha: Entrenadores -->
                            <div class="col-lg-5 p-2">
                                {% if club.entrenadores.all %}
                                    <h5 class="mb-4">Entrenadores</h5>
                                    <div class="row">
                                        {% for e in club.entrenadores.all %}
                                            <div class="col-6 d-flex align-items-center mb-3 user-select: none;">
                                                {% if e.avatar %}
                                                    <img src="{{ e.avatar.url }}"
                                                         alt="{{ e.nombre }}"
                                                         class="rounded-circle me-3"
                                                         style="width: 60px;
                                                                height: 60px;
                                                                object-fit: cover">
                                                {% else %}
                                                    <div class="rounded-circle bg-black text-white d-flex justify-content-center align-items-center me-3"
                                                         style="width: 60px;
                                                                height: 60px">{{ e.nombre|first|upper }}</div>
                                                {% endif %}
                                                {% if e.slug %}
                                                    <a href="{% url 'coach_profile' e.slug %}"
                                                       class="text-decoration-none text-reset">{{ e.nombre }} {{ e.apellidos }}</a>
                                                {% else %}
                                                    <span>{{ e.nombre }} {{ e.apellidos }}</span>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <!-- Fila completa: Instalaciones y equipamiento -->
                            <div class="col-12 mt-4">
                                <h5 class="mb-3">Instalaciones y equipamiento</h5>
                                <div class="d-flex flex-wrap gap-3">
                                    {% for feature in club.features.all %}
                                        <div class="border rounded  d-flex align-items-center "
                                             style="padding:8px 16px">
                                            {% if feature.icon %}
                                                <img src="{{ feature.icon.url }}"
                                                     alt="{{ feature.name }}"
                                                     style="width: 50px;
                                                            height: 50px;
                                                            object-fit: contain;
                                                            user-select:none"
                                                     class="me-2">
                                            {% endif %}
                                            <div class="text-wrap" style="font-size: 14px; user-select:none;">{{ feature.name }}</div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Horarios -->
                    <div class=" p-3 tab-pane fade" id="schedule" role="tabpanel">
                        <p id="open-status" class="fw-bold"></p>
                        <div class="table-responsive mt-3">
                            <table class="table table-bordered text-center align-middle mb-0"
                                   style="min-width: 700px">
                                <thead class="table-dark">
                                    <tr>
                                        {% for dia, nombre in club.horarios.model.DiasSemana.choices %}<th scope="col">{{ nombre }}</th>{% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        {% for dia, nombre in club.horarios.model.DiasSemana.choices %}
                                            <td class="schedule-day" data-day="{{ dia }}">
                                                {% with horarios_dia=club.horarios.all|dictsort:"hora_inicio" %}
                                                    {% for h in horarios_dia %}
                                                        {% if h.dia == dia %}
                                                            {% if h.estado == 'abierto' %}
                                                                <div class="border-bottom py-1 small text-muted schedule-item"
                                                                     data-start="{{ h.hora_inicio|time:'H:i' }}"
                                                                     data-end="{{ h.hora_fin|time:'H:i' }}">
                                                                    {{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fin|time:"H:i" }}
                                                                </div>
                                                            {% else %}
                                                                <div class="border-bottom py-1 small text-danger">Cerrado</div>
                                                            {% endif %}
                                                        {% endif %}
                                                    {% empty %}
                                                        <span class="text-muted">â</span>
                                                    {% endfor %}
                                                {% endwith %}
                                            </td>
                                        {% endfor %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        {% if club.clases.all %}
                            <div class="mt-4">
                                <h5>Clases</h5>
                                <ul class="list-group">
                                    {% for c in club.clases.all %}
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <span>{{ c.nombre }} ({{ c.hora_inicio|time:"H:i" }} - {{ c.hora_fin|time:"H:i" }})</span>
                                            {% if user.is_authenticated %}
                                                <form action="{% url 'book_clase' c.id %}" method="post" class="ms-2">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-sm btn-primary">Reservar</button>
                                                </form>
                                            {% else %}
                                                <button type="button"
                                                        class="btn btn-sm btn-primary ms-2"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#signupModal">Reservar</button>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </div>
                    <!-- Posts -->
                    <div class="p-3 tab-pane fade" id="posts" role="tabpanel"> 
                            <div class=" justify-content-center  d-flex flex-column align-items-center">
                                {% if user.is_authenticated and user == club.owner %}
                                    {% include 'clubs/_post_form.html' %}  
                                {% endif %}
                            </div> 
                        {% for post in posts %}
                          <div class="mt-3 mb-3 col-8 border rounded p-4 mx-auto"> 
                                <div class="d-flex mb-2   justify-content-center  ">
                                    {% if post.user.profile.avatar %}
                                        <img src="{{ post.user.profile.avatar.url }}"   alt="{{ post.user.username }}"  class="review-avatar-img rounded-circle">
                                    {% else %}
                                        <div class="review-avatar me-3">{{ post.user.username|first|upper }}</div>
                                    {% endif %}
                                    <div class="flex-grow-1 me-3">
                                        <span class="fw-bold ">{{ post.user.username }}</span>
                                        <small class="text-muted ">{{ post.created_at|time_since_short }}</small>
                                        <div class="mt-4 mb-4 col-12" >
                                                 {% if post.image %}<img src="{{ post.image.url }}" class="img-fluid mb-2" alt="imagen"  style="max-height:300px;">{% endif %} 
                                                 <div class="">
                                                            {{ post.contenido|youtube_embed }}
                                                            </div>                    
                                                </div>
                                        <div class="d-flex ">
                                            <span class="d-flex btn p-0 post-like {% if user.is_authenticated and user in post.likes.all %}liked{% endif %}"
                                                    data-url="{% url 'clubpost_like' post.pk %}">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 512 512"><path fill="black" d="m225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144c39.4-7.6 79.7 1.5 111.8 24.1c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c32.1-22.6 72.4-31.7 111.8-24.2C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20l-.1-.1c-23.1-25.9-58-37.7-92-31.2c-46.6 8.9-80.2 49.5-80.2 96.9v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7L431.2 268a102.7 102.7 0 0 0 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2l-.1.1l-.1.1l-17.8 20c-.3.4-.7.7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"/></svg>
                                                <span class="text-black like-count ms-1">{{ post.likes.count }}</span>
                                            </span>
                                            <a class="ms-2 d-flex text-decoration-none text-reset"
                                               data-bs-toggle="collapse"
                                               href="#replies-{{ post.pk }}"
                                               role="button"
                                               aria-expanded="false">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     width="20"
                                                     height="20"
                                                     viewBox="0 0 24 24">
                                                    <g fill="none">
                                                    <path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z" />
                                                    <path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10H4a2 2 0 0 1-2-2v-8C2 6.477 6.477 2 12 2Zm0 2a8 8 0 0 0-8 8v8h8a8 8 0 1 0 0-16Zm0 10a1 1 0 0 1 .117 1.993L12 16H9a1 1 0 0 1-.117-1.993L9 14h3Zm3-4a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h6Z" />
                                                    </g>
                                                </svg>
                                                <span class="ms-1">{{ post.replies.count }}</span>
                                            </a>
                                            <button type="button" class="ms-2  p-0 post-share">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     width="20"
                                                     height="20"
                                                     viewBox="0 0 24 24">
                                                    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                                                    <circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" />
                                                    <path d="m8.59 13.51l6.83 3.98m-.01-10.98l-6.82 3.98" />
                                                    </g>
                                                </svg>
                                            </button>
                                            <div class="ms-auto d-flex align-items-center gap-1">
                                                {% if user.is_authenticated and user == post.user %}
                                                    <button type="button"
                                                            class="btn btn-sm btn-link p-0"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#editPostModal{{ post.pk }}">
                                                        <!-- Edit SVG -->
                                                        <svg style="height:15px"
                                                             viewBox="0 0 512 512"
                                                             xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M495.6 49.23..." />
                                                        </svg>
                                                    </button>
                                                    <form action="{% url 'clubpost_delete' post.pk %}"
                                                          method="post"
                                                          class="d-inline">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn btn-sm btn-link text-danger p-0">
                                                            <!-- Delete SVG -->
                                                            <svg style="height:15px"
                                                                 viewBox="0 0 448 512"
                                                                 xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M432 80h-82.38..." />
                                                            </svg>
                                                        </button>
                                                    </form>
                                                {% endif %}
                                            </div>
                                            <div class="ms-auto d-flex align-items-center gap-3">
                                                {% if user.is_authenticated and user == post.user %}
                                                    <button type="button"
                                                            class="btn btn-sm btn-link p-0"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#editPostModal{{ post.pk }}">
                                                        <!-- Edit SVG -->
                                                        <svg style="height:15px"
                                                             viewBox="0 0 512 512"
                                                             xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M495.6 49.23l-32.82-32.82C451.8 5.471 437.5 0 423.1 0c-14.33 0-28.66 5.469-39.6 16.41L167.5 232.5C159.1 240 154.8 249.5 152.4 259.8L128.3 367.2C126.5 376.1 133.4 384 141.1 384c.916 0 1.852-.0918 2.797-.2813c0 0 74.03-15.71 107.4-23.56c10.1-2.377 19.13-7.459 26.46-14.79l217-217C517.5 106.5 517.4 71.1 495.6 49.23zM461.7 94.4L244.7 311.4C243.6 312.5 242.5 313.1 241.2 313.4c-13.7 3.227-34.65 7.857-54.3 12.14l12.41-55.2C199.6 268.9 200.3 267.5 201.4 266.5l216.1-216.1C419.4 48.41 421.6 48 423.1 48s3.715 .4062 5.65 2.342l32.82 32.83C464.8 86.34 464.8 91.27 461.7 94.4zM424 288c-13.25 0-24 10.75-24 24v128c0 13.23-10.78 24-24 24h-304c-13.22 0-24-10.77-24-24v-304c0-13.23 10.78-24 24-24h144c13.25 0 24-10.75 24-24S229.3 64 216 64L71.1 63.99C32.31 63.99 0 96.29 0 135.1v304C0 479.7 32.31 512 71.1 512h303.1c39.69 0 71.1-32.3 71.1-72L448 312C448 298.8 437.3 288 424 288z" />
                                                        </svg>
                                                    </button>
                                                    <form action="{% url 'clubpost_delete' post.pk %}"
                                                          method="post"
                                                          class="d-inline">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn btn-sm btn-link text-danger p-0">
                                                            <!-- Delete SVG -->
                                                            <svg style="height:15px"
                                                                 viewBox="0 0 448 512"
                                                                 xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M432 80h-82.38l-34-56.75C306.1 8.827 291.4 0 274.6 0H173.4C156.6 0 141 8.827 132.4 23.25L98.38 80H16C7.125 80 0 87.13 0 96v16C0 120.9 7.125 128 16 128H32v320c0 35.35 28.65 64 64 64h256c35.35 0 64-28.65 64-64V128h16C440.9 128 448 120.9 448 112V96C448 87.13 440.9 80 432 80zM171.9 50.88C172.9 49.13 174.9 48 177 48h94c2.125 0 4.125 1.125 5.125 2.875L293.6 80H154.4L171.9 50.88zM352 464H96c-8.837 0-16-7.163-16-16V128h288v320C368 456.8 360.8 464 352 464zM224 416c8.844 0 16-7.156 16-16V192c0-8.844-7.156-16-16-16S208 183.2 208 192v208C208 408.8 215.2 416 224 416zM144 416C152.8 416 160 408.8 160 400V192c0-8.844-7.156-16-16-16S128 183.2 128 192v208C128 408.8 135.2 416 144 416zM304 416c8.844 0 16-7.156 16-16V192c0-8.844-7.156-16-16-16S288 183.2 288 192v208C288 408.8 295.2 416 304 416z" />
                                                            </svg>
                                                        </button>
                                                    </form>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- replies -->
                                <div class="collapse mt-3 ms-5 me-5" id="replies-{{ post.pk }}">
                                    {% for reply in post.replies.all %}
                                        <div class="d-flex border-top pt-4 pb-4 ">
                                            {% if reply.user.profile.avatar %}
                                                <img src="{{ reply.user.profile.avatar.url }}"
                                                     alt="{{ reply.user.username }}"
                                                     class="review-avatar-img rounded-circle me-2">
                                            {% else %}
                                                <div class="review-avatar me-2">{{ reply.user.username|first|upper }}</div>
                                            {% endif %}
                                            <div>
                                                 <span class="fw-bold me-1">{{ post.user.username }}</span>
                                                  <small class="text-muted ">{{ post.created_at|time_since_short }}</small>  
                                                  <div class="mt-2 mb-2">
                                                    {{ reply.contenido }}
                                                 </div>
                                            </div>
                                        </div>
                                    {% empty %}
                                        <p class="text-muted">No hay respuestas.</p>
                                    {% endfor %}
                                    {% if user.is_authenticated %}
                                        <div class="d-flex mt-3">
                                            {% if user.profile.avatar %}
                                                <img src="{{ user.profile.avatar.url }}"    alt="{{ user.username }}"  class="review-avatar-img rounded-circle me-2">
                                            {% else %}
                                                <div class="review-avatar me-2">{{ user.username|first|upper }}</div>
                                            {% endif %}
                                            <form method="post"
                                                  action="{% url 'clubpost_reply' post.pk %}"
                                                  class="d-flex flex-grow-1 gap-2">
                                                {% csrf_token %}
                                                {{ reply_form.contenido }}
                                                <button type="submit" class="btn btn-primary btn-sm">Responder</button>
                                            </form>
                                        </div>
                                    {% else %}
                                        <p class="text-muted mt-2">Inicia sesiÃ³n para responder.</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% include 'clubs/_post_edit_modal.html' with post=post %}
                        {% empty %}
                        
                            <p  class="m-3 justify-content-center d-flex flex-column align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 256 256"><path fill="currentColor" d="m198.24 62.63l15.68-17.25a8 8 0 0 0-11.84-10.76L186.4 51.86A95.95 95.95 0 0 0 57.76 193.37l-15.68 17.25a8 8 0 1 0 11.84 10.76l15.68-17.24A95.95 95.95 0 0 0 198.24 62.63M48 128a80 80 0 0 1 127.6-64.25l-107 117.73A79.63 79.63 0 0 1 48 128m80 80a79.55 79.55 0 0 1-47.6-15.75l107-117.73A79.95 79.95 0 0 1 128 208"/></svg>
                                
                                No hay publicaciones.</p>
                        {% endfor %}
                    </div>
                    <!-- Competidores -->
                    <div class="p-1 tab-pane fade" id="competitors">
                        {% if competidores %}
                            <div class="table-responsive ">
                                <table class="table table-sm text-center competitors-table">
                                    <tbody>
                                        {% for competidor in competidores %}
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center justify-content-center">
                                                        {% if competidor.avatar %}
                                                            <img src="{{ competidor.avatar.url }}"
                                                                 alt="{{ competidor.nombre }}"
                                                                 class="competitor-avatar-img me-2">
                                                        {% else %}
                                                            <div class="competitor-avatar me-2">{{ competidor.nombre|initials }}</div>
                                                        {% endif %}
                                                        <span>{{ competidor.nombre }}</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    {% with rec=competidor.record_tuple %}
                                                        <span class="text-success fw-bold">{{ rec.0 }}</span>-<span class="text-danger fw-bold">{{ rec.1 }}</span>-<span class="text-primary fw-bold">{{ rec.2 }}</span>
                                                    {% endwith %}
                                                </td>
                                                <td>{{ competidor.categoria }}</td>
                                                <td>{{ competidor.palmares|default:"â" }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="mt-3 text-muted">Este club aÃºn no tiene competidores registrados.</p>
                        {% endif %}
                    </div>
                    <!-- Comentarios -->
                    <div class="p-3 tab-pane fade" id="comments">
                        <div class="row">
                            <div class="col-lg-12 ">
                                <div class=" d-flex justify-content-between align-items-center  flex-wrap mb-4 ">
                                    <div class="">
                                        {% if not reseÃ±a_existente %}
                                            {% if user.is_authenticated %}
                                                <button type="button"
                                                        class="btn btn-dark"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#reviewModal">Dejar reseÃ±a</button>
                                            {% else %}
                                                <button type="button"
                                                        class="btn btn-dark"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#loginModal">Dejar reseÃ±a</button>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="col-auto">{% include 'partials/_review-filter.html' with orden=orden club=club %}</div>
                                </div>
                                <div class="mt-2 " id="review-list">{% include 'clubs/reviews_list.html' %}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Columna Derecha: Valoraciones y ReseÃ±as -->
            <div class="col-lg-2">
                <!-- Carrusel de reseÃ±as -->
                {% if reseÃ±as %}
                    <div class="club-reviews">
                        <div class="review-carousel border rounded"
                             id="review-carousel"
                             onmouseenter="pauseAutoplay()"
                             onmouseleave="startAutoplay()">
                            {% for reseÃ±a in reseÃ±as %}
                                <div class="p-4 review-slide{% if forloop.first %} active{% endif %}">
                                    <p class="review-text">â{{ reseÃ±a.comentario }}â</p>
                                    <div class="review-user-container d-flex align-items-center position-fixed bottom-0  mb-4 ">
                                        {% if reseÃ±a.usuario.profile.avatar %}
                                            <img src="{{ reseÃ±a.usuario.profile.avatar.url }}"
                                                 alt="{{ reseÃ±a.usuario.username }}"
                                                 class="review-avatar-img rounded-circle">
                                        {% else %}
                                            <div class="review-avatar bg-black text-white">{{ reseÃ±a.usuario.username|first|upper }}</div>
                                        {% endif %}
                                        <div class="fw-medium ms-2 review-username">{{ reseÃ±a.usuario.username }}</div>
                                    </div>
                                </div>
                            {% endfor %}
                            <!-- Arrows -->
                            <button id="prevBtn" class="review-arrow left" onclick="changeSlide(-1)">
                                <svg viewBox="0 0 48 48" width="20" height="20">
                                    <path d="M30.83 32.67l-9.17-9.17 9.17-9.17-2.83-2.83-12 12 12 12z" />
                                    <path d="M0-.5h48v48h-48z" fill="none" />
                                </svg>
                            </button>
                            <button id="nextBtn" class="review-arrow right" onclick="changeSlide(1)">
                                <svg viewBox="0 0 48 48"
                                     width="20"
                                     height="20"
                                     style="transform: rotate(180deg)">
                                    <path d="M30.83 32.67l-9.17-9.17 9.17-9.17-2.83-2.83-12 12 12 12z" />
                                    <path d="M0-.5h48v48h-48z" fill="none" />
                                </svg>
                            </button>
                        </div>
                        <ul class="list-group  ">
                            <div class="d-flex flex-wrap   rounded   p-4 col-12">
                                <!-- Rating promedio a la izquierda -->
                                <div class="d-flex flex-column align-items-start col-6">
                                    <span class="fs-4 fw-bold">{{ club.average_rating }} <small style="font-size:12px">/ 5</small></span>
                                    <span class="  fw-light" style="font-size:12px">({{ club.reviews_count }} reseÃ±as)</span>
                                </div>
                                <!-- Valoraciones detalladas a la derecha -->
                                <div class="d-flex flex-column align-items-start  small rounded flex-grow-1 col-6">
                                    <span>Instalaciones</span>
                                    <span class="d-flex mb-2">{% render_stars detallado.instalaciones %}</span>
                                    <span>Entrenadores</span>
                                    <span class="d-flex mb-2">{% render_stars detallado.entrenadores %}</span>
                                    <span>Calidad/precio</span>
                                    <span class="d-flex mb-2">{% render_stars detallado.calidad_precio %}</span>
                                    <span>Ambiente</span>
                                    <span class="d-flex mb-2">{% render_stars detallado.ambiente %}</span>
                                    <span>Variedad clases</span>
                                    <span class="d-flex">{% render_stars detallado.variedad_clases %}</span>
                                </div>
                            </div>
                        </ul>
                    </div>
                {% else %}
                    <p class="mt-4">Este club aÃºn no tiene reseÃ±as.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% include 'partials/_share_profile_modal.html' %}
    {% include 'partials/_register_modal.html' %}
    <div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-3">
                <div class="modal-header">
                    <h5 class="modal-title">Dejar reseÃ±a</h5>
                    <button type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="col-lg-6 mb-4">
                        {% if user.is_authenticated %}
                            {% if not reseÃ±a_existente %}
                                <form method="POST" id="reseÃ±a-form">
                                    {% csrf_token %}
                                    {% if form.errors %}<div class="alert alert-danger">Por favor completa todos los campos obligatorios.</div>{% endif %}
                                    <div class="mb-3">
                                        <input type="text"
                                               name="titulo"
                                               class="form-control"
                                               placeholder="TÃ­tulo de la reseÃ±a"
                                               required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label d-block mb-1">Instalaciones:</label>
                                        <div class="star-rating mb-2" data-name="instalaciones"></div>
                                        <input type="hidden" name="instalaciones" required id="input-instalaciones">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label d-block mb-1">Entrenadores:</label>
                                        <div class="star-rating mb-2" data-name="entrenadores"></div>
                                        <input type="hidden" name="entrenadores" required id="input-entrenadores">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label d-block mb-1">Ambiente:</label>
                                        <div class="star-rating mb-2" data-name="ambiente"></div>
                                        <input type="hidden" name="ambiente" required id="input-ambiente">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label d-block mb-1">Calidad-precio:</label>
                                        <div class="star-rating mb-2" data-name="calidad_precio"></div>
                                        <input type="hidden"
                                               name="calidad_precio"
                                               required
                                               id="input-calidad_precio">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label d-block mb-1">Variedad de clases:</label>
                                        <div class="star-rating mb-2" data-name="variedad_clases"></div>
                                        <input type="hidden"
                                               name="variedad_clases"
                                               required
                                               id="input-variedad_clases">
                                    </div>
                                    <div class="mb-3">
                                        <textarea name="comentario"
                                                  class="form-control"
                                                  rows="4"
                                                  minlength="200"
                                                  placeholder="Â¿QuÃ© te ha gustado o quÃ© mejorarÃ­as del club?"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-dark">Enviar ReseÃ±a</button>
                                </form>
                                <div id="mensaje-gracias"
                                     class="alert alert-success mt-3"
                                     style="display:none">
                                    Gracias por valorar el club. Tu reseÃ±a serÃ¡ publicada en breve.
                                </div>
                            {% else %}
                                <!-- <p>Ya has dejado una reseÃ±a para este club.</p> -->
                            {% endif %}
                        {% else %}
                            <!-- <p><a href="{% url 'login' %}">Inicia sesiÃ³n</a> para dejar tu reseÃ±a.</p> -->
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'js/review-filter.js' %}"></script>
    <script src="{% static 'js/slides.js' %}"></script>
    <script src="{% static 'js/rating.js' %}"></script>
    <script src="{% static 'js/share-like.js' %}"></script>
    <script src="{% static 'js/share-modal.js' %}"></script>
    <script src="{% static 'js/post-like.js' %}"></script>
    <script src="{% static 'js/gallery-slideshow.js' %}"></script>
    <script src="{% static 'js/schedule-status.js' %}"></script>
    <script src="{% static 'js/club-tabs.js' %}"></script>
    <script src="{% static 'js/post-media-preview.js' %}"></script>
{% endblock %}
