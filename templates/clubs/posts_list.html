{% load utils_filters %}
{% for post in posts %}
  <div class="mt-3 mb-3 col-8 border rounded p-4 mx-auto">
    <div class="d-flex mb-2   justify-content-center  ">
      {% if post.user.profile.avatar %}
        <img src="{{ post.user.profile.avatar.url }}"   alt="{{ post.user.username }}"  class="review-avatar-img rounded-circle">
      {% else %}
        <div class="review-avatar me-3">{{ post.user.username|first|upper }}</div>
      {% endif %}
      <div class="flex-grow-1 me-3">
        <span class="fw-bold ">{{ post.user.username }}</span>
        <small class="text-muted ">{{ post.created_at|time_since_short }}</small>
        <div class="mt-4 mb-4 col-12" >
             {% if post.image %}<img src="{{ post.image.url }}" class="img-fluid mb-2" alt="imagen"  style="max-height:300px;">{% endif %}
             <div class="">
                        {{ post.contenido|youtube_embed }}
                        </div>
        </div>
        <div class="d-flex ">
            <span class="d-flex btn p-0 post-like {% if user.is_authenticated and user in post.likes.all %}liked{% endif %}"
                    data-url="{% url 'clubpost_like' post.pk %}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 512 512"><path fill="black" d="m225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144c39.4-7.6 79.7 1.5 111.8 24.1c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c32.1-22.6 72.4-31.7 111.8-24.2C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20l-.1-.1c-23.1-25.9-58-37.7-92-31.2c-46.6 8.9-80.2 49.5-80.2 96.9v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7L431.2 268a102.7 102.7 0 0 0 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2l-.1.1l-.1.1l-17.8 20c-.3.4-.7.7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"/></svg>
                <span class="text-black like-count ms-1">{{ post.likes.count }}</span>
            </span>
            <a class="ms-2 d-flex text-decoration-none text-reset"
               data-bs-toggle="collapse"
               href="#replies-{{ post.pk }}"
               role="button"
               aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="20"
                     height="20"
                     viewBox="0 0 24 24">
                    <g fill="none">
                    <path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z" />
                    <path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10H4a2 2 0 0 1-2-2v-8C2 6.477 6.477 2 12 2Zm0 2a8 8 0 0 0-8 8v8h8a8 8 0 1 0 0-16Zm0 10a1 1 0 0 1 .117 1.993L12 16H9a1 1 0 0 1-.117-1.993L9 14h3Zm3-4a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h6Z" />
                    </g>
                </svg>
                <span class="ms-1">{{ post.replies.count }}</span>
            </a>
            <button type="button" class="ms-2  p-0 post-share">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="20"
                     height="20"
                     viewBox="0 0 24 24">
                    <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                    <circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" />
                    <path d="m8.59 13.51l6.83 3.98m-.01-10.98l-6.82 3.98" />
                    </g>
                </svg>
            </button>
            <div class="ms-auto d-flex align-items-center gap-1">
                {% if user.is_authenticated and user == post.user %}
                    <a href="{% url 'clubpost_update' post.pk %}" class="btn btn-sm btn-link p-0">
                        <svg style="height:15px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M495.6 49.23..."/></svg>
                    </a>
                    <form action="{% url 'clubpost_delete' post.pk %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-link text-danger">
                            <svg style="height:15px" viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M432 80h-82.38..."/></svg>
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>
        <div class="collapse" id="replies-{{ post.pk }}">
            {% for reply in post.replies.all %}
                <div class="ms-3 mt-3">
                    <strong>{{ reply.user.username }}</strong>
                    <small class="text-muted">{{ reply.created_at|time_since_short }}</small>
                    <p class="mb-0">{{ reply.contenido }}</p>
                </div>
            {% endfor %}
            <form method="post" action="{% url 'clubpost_reply' post.pk %}">
                {% csrf_token %}
                {{ reply_form.contenido }}
                <button type="submit" class="btn btn-sm btn-dark mt-2">Responder</button>
            </form>
        </div>
      </div>
    </div>
  </div>
{% empty %}
  <p class="text-muted text-center">No hay publicaciones.</p>
{% endfor %}
{% if posts.has_other_pages %}
<nav class="mt-4" aria-label="Paginar publicaciones">
  <ul class="pagination justify-content-center ajax" data-target="posts-list">
    {% if posts.has_previous %}
      <li class="page-item"><a class="page-link" href="{% url 'ajax_posts' club.slug %}?post_page={{ posts.previous_page_number }}{% if request.GET.orden %}&orden={{ request.GET.orden }}{% endif %}">«</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">«</span></li>
    {% endif %}
    {% for num in posts.paginator.page_range %}
      {% if posts.number == num %}
        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
      {% else %}
        <li class="page-item"><a class="page-link" href="{% url 'ajax_posts' club.slug %}?post_page={{ num }}{% if request.GET.orden %}&orden={{ request.GET.orden }}{% endif %}">{{ num }}</a></li>
      {% endif %}
    {% endfor %}
    {% if posts.has_next %}
      <li class="page-item"><a class="page-link" href="{% url 'ajax_posts' club.slug %}?post_page={{ posts.next_page_number }}{% if request.GET.orden %}&orden={{ request.GET.orden }}{% endif %}">»</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">»</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
